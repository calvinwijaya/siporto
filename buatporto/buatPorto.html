<link rel="stylesheet" href="buatporto/style.css">

<div class="container-fluid py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="display-6 fw-bold text-primary mb-0">Buat Portofolio Baru</h1>
        <span class="badge bg-primary px-3 py-2">Tahun Akademik 2025/2026</span>
    </div>

    <div class="accordion mb-4" id="rpkpsAccordion">
        <div class="accordion-item shadow-sm">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed fw-bold" type="button" data-bs-toggle="collapse" data-bs-target="#collapseRPKPS">
                    <i class="bi bi-folder2-open me-2"></i> Link RPKPS & Portofolio (Referensi)
                </button>
            </h2>
            <div id="collapseRPKPS" class="accordion-collapse collapse" data-bs-parent="#rpkpsAccordion">
                <div class="accordion-body">
                    <div class="table-responsive">
                        <table class="table table-sm table-hover align-middle">
                            <thead class="table-light">
                                <tr>
                                    <th>Deskripsi</th>
                                    <th>Tautan</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Template RPKPS (New)</td>
                                    <td><a href="https://drive.google.com/drive/folders/1ag3HJs5qA8oxGiXChU3iXuPaPKibbWd8?usp=sharing" class="btn btn-sm btn-outline-primary"></i>Buka Link</a></td>
                                </tr>
                                <tr>
                                    <td>Basisdata RPKPS</td>
                                    <td>
                                        <div class="btn-group">
                                            <a href="https://docs.google.com/spreadsheets/d/1k0fT4Xq_DxciS0LIzynbmjU6bwp4LM0V_L5bD917yBo/edit?usp=sharing" class="btn btn-sm btn-light border">S1</a>
                                            <a href="https://drive.google.com/drive/folders/1nUy3L6JdNMv57Tpm9A3qr9oZbqHqm6Mp?usp=sharing" class="btn btn-sm btn-light border">S2</a>
                                            <a href="https://drive.google.com/drive/folders/1r05RCeys3_6nMLxRDgdE9rWuWxN6_zRO?usp=sharing" class="btn btn-sm btn-light border">S3</a>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Peta Kurikulum</td>
                                    <td>
                                        <div class="btn-group">
                                            <a href="https://docs.google.com/spreadsheets/d/1bGLwJS37uzSJFAzyYarP0eGzbNK8EkoO/edit?usp=sharing" class="btn btn-sm btn-light border">S1</a>
                                            <a href="https://docs.google.com/spreadsheets/d/1NtpGuMfTHzXUln1cxr8hoLKgS9-Q1R2H50FIWtidd5A/edit?usp=sharing" class="btn btn-sm btn-light border">S2</a>
                                            <a href="https://docs.google.com/spreadsheets/d/19BSaXlDpsPrpmhzuguTL2gmGxssqi6H_w7oy6Q60iog/edit?usp=sharing" class="btn btn-sm btn-light border">S3</a>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Unggah Portofolio</td>
                                    <td><a href="http://ugm.id/Portofolio2024" class="btn btn-sm btn-outline-primary"></i>Buka Link</a></td>
                                </tr>  
                                <tr>
                                    <td>Unggah RPKPS Format Baru</td>
                                    <td>
                                        <div class="btn-group">
                                            <a href="http://ugm.id/SarjanaRPKPS" class="btn btn-sm btn-light border">S1</a>
                                            <a href="http://ugm.id/MagisterRPKPS" class="btn btn-sm btn-light border">S2</a>
                                            <a href="http://ugm.id/DoktorRPKPS" class="btn btn-sm btn-light border">S3</a>
                                        </div>
                                    </td>
                                </tr>     
                                <tr>
                                    <td>Pembagian Tugas RPKPS & Portofolio</td>
                                    <td><a href="http://ugm.id/PembagianRPKPSPortofolio" class="btn btn-sm btn-outline-primary"></i>Buka Link</a></td>
                                </tr>
                                <tr>
                                    <td>Unggah Nilai Mentah</td>
                                    <td>
                                        <div class="btn-group">
                                            <a href="http://ugm.id/NilaiMentahMKS1TGD" class="btn btn-sm btn-light border">S1</a>
                                            <a href="http://ugm.id/NilaiMentahMKPascaTeknikGeomatika" class="btn btn-sm btn-light border">S2</a>
                                            <a href="http://ugm.id/NilaiMentahMKPascaTeknikGeomatika" class="btn btn-sm btn-light border">S3</a>
                                        </div>
                                    </td>
                                </tr>                                                                                                                                                       
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="card shadow-sm border-0 mb-4">
        <div class="card-body">
            <div class="row g-3">
                <div class="row g-3 align-items-center"><div class="col-md-12 d-flex align-items-center"> <label class="form-label fw-bold mb-0 me-3" style="min-width: 70px;">Jenjang:</label>
                    <div id="jenjangButtons" class="d-flex gap-2">
                        </div>
                </div>

                <div class="col-md-6 position-relative">
                    <label class="form-label fw-bold">Cari Mata Kuliah</label>
                    <div class="input-group">
                        <span class="input-group-text bg-white"><i class="bi bi-search"></i></span>
                        <input type="text" id="searchMK" class="form-control" placeholder="Ketik nama mata kuliah..." oninput="filterMK()">
                    </div>
                    <div id="mkSuggestions" class="list-group position-absolute w-100 z-3 shadow-sm"></div>
                </div>

                <div class="col-md-3">
                    <label class="form-label fw-bold">Kelas</label>
                    <select id="kelas" class="form-select">
                        <option value="A">Kelas A</option>
                        <option value="B">Kelas B</option>
                        <option value="C">Kelas C</option>
                        <option value="IUP">IUP</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label fw-bold">Tahun-Semester</label>
                    <select id="tahun" class="form-select" disabled>
                        <option value="2025-1">2025-1</option>
                    </select>
                </div>

                <div class="col-md-4">
                    <label class="form-label fw-bold">Jumlah CPMK</label>
                    <input type="number" id="jumlahCPMK" class="form-control" min="1" placeholder="Contoh: 4">
                </div>
                <div class="col-md-8">
                    <label class="form-label fw-bold">CPL MK</label>
                    <div id="cplButtons" class="d-flex flex-wrap gap-2"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="card shadow-sm border-0 mb-4">
        <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
            <h5 class="mb-0 fw-bold text-primary">Rencana Asesmen</h5>
            <div>
                <button class="btn btn-sm btn-success" onclick="addAssessmentRow()"><i class="bi bi-plus-lg"></i></button>
                <button class="btn btn-sm btn-danger" onclick="removeAssessmentRow()"><i class="bi bi-dash-lg"></i></button>
            </div>
        </div>
        <div class="card-body">
            <div class="row g-2 mb-2 d-none d-md-flex px-3">
                <div class="col-md-2"><small class="fw-bold">CPMK</small></div>
                <div class="col-md-2"><small class="fw-bold">Tipe</small></div>
                <div class="col-md-2"><small class="fw-bold">Deskripsi</small></div>
                <div class="col-md-2"><small class="fw-bold">Bobot (%)</small></div>
                <div class="col-md-1"><small class="fw-bold">Maks</small></div>
                <div class="col-md-1"><small class="fw-bold">CPL</small></div>
                <div class="col-md-2"><small class="fw-bold">PI</small></div>
            </div>            

            <div id="assessmentRows" class="mb-2"></div>
            <div id="persentaseWarning" class="form-text"></div>
        </div>
    </div>

    <div class="card shadow-sm border-0 mb-4">
        <div class="card-body">
            <div class="row align-items-end g-3">
                <div class="col-md-4">
                    <label class="form-label fw-bold">Jumlah Mahasiswa</label>
                    <input type="number" id="jumlahMahasiswa" class="form-control" min="1">
                </div>
                <div class="col-md-8 text-end">
                    <button class="btn btn-outline-secondary" onclick="saveTemplate()"><i class="bi bi-save"></i> Save Template</button>
                    <label class="btn btn-outline-secondary mb-0" for="templateUpload"><i class="bi bi-upload"></i> Load Template</label>
                    <input type="file" id="templateUpload" hidden onchange="loadTemplate(event)">
                </div>
            </div>
            
            <hr class="my-4">
            
            <div class="d-flex flex-wrap gap-2 justify-content-center">
                <button class="btn btn-primary px-4" onclick="generateCSVTemplate()">1. Generate Form Nilai</button>
                <label class="btn btn-info text-white px-4 mb-0" for="csvUpload">2. Upload Nilai</label>
                <input type="file" id="csvUpload" hidden />
                <button class="btn btn-warning text-white px-4" onclick="generateCPMKPortfolio()">3. Kalkulasi Portofolio</button>
                <div id="uploadStatus" class="mt-3"></div>
            </div>
        </div>
    </div>

    <div id="sectionCPMK" class="card shadow-sm border-0 mb-4 d-none">
        <div class="card-header bg-white border-0 pt-3 d-flex justify-content-between align-items-center">
            <h6 class="fw-bold text-primary mb-0"><i class="bi bi-bar-chart-fill me-2"></i>Performa CPMK</h6>
            <button class="btn btn-sm btn-outline-primary shadow-sm" onclick="downloadChart('cpmkChart', 'Chart_CPMK')">
                <i class="bi bi-download me-1"></i> Unduh Gambar
            </button>
        </div>
        <div class="card-body">
            <div class="row align-items-center">
                <div class="col-lg-4">
                    <div id="cpmkPerformance"></div>
                </div>
                <div class="col-lg-8">
                    <div style="position: relative; height:300px; width:100%;">
                        <canvas id="cpmkChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="sectionCPL" class="card shadow-sm border-0 mb-4 d-none">
        <div class="card-body">
            <h6 class="fw-bold text-info mb-3"><i class="bi bi-graph-up-arrow me-2"></i>Performa CPL</h6>
            <button class="btn btn-sm btn-outline-primary shadow-sm" onclick="downloadChart('cplChart', 'Chart_CPL')">
                <i class="bi bi-download me-1"></i> Unduh Gambar
            </button>
            <div class="row align-items-center">
                <div class="col-lg-4">
                    <div id="cplPerformance"></div>
                </div>
                <div class="col-lg-8">
                    <div style="position: relative; height:350px;">
                        <canvas id="cplChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="sectionPI" class="card shadow-sm border-0 mb-4 d-none">
        <div class="card-body">
            <h6 class="fw-bold text-danger mb-3"><i class="bi bi-bullseye me-2"></i>Performa PI</h6>
            <button class="btn btn-sm btn-outline-primary shadow-sm" onclick="downloadChart('piChart', 'Chart_PI')">
                <i class="bi bi-download me-1"></i> Unduh Gambar
            </button>
            <div class="row flex-column"> <div class="col-12 mb-3">
                    <div id="piPerformance"></div>
                </div>
                <div class="col-12">
                    <div style="position: relative; height:400px; width: 100%;">
                        <canvas id="piChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="card shadow-sm border-0 mb-4">
        <div class="card-body">
            <div class="mb-3">
                <label class="form-label fw-bold text-danger">Evaluasi Hasil Pembelajaran</label>
                <textarea id="evaluasi" class="form-control" rows="4"></textarea>
            </div>
            <div class="mb-3">
                <label class="form-label fw-bold text-success">Rencana Pengembangan</label>
                <textarea id="rencana" class="form-control" rows="4"></textarea>
            </div>
        </div>
    </div>

    <div class="d-grid gap-2 d-md-flex justify-content-md-center mb-5">
        <button class="btn btn-lg btn-dark shadow" onclick="generateAndDownloadFullPortfolio()"><i class="bi bi-file-earmark-word"></i> Download Porto</button>
        <button class="btn btn-lg btn-primary shadow" onclick="sendToSheet()"><i class="bi bi-cloud-upload"></i> Kirim Nilai MK</button>
    </div>
</div>